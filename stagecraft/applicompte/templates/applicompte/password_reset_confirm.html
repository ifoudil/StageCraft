{% extends 'applistagecraft/base.html' %}

{% block title %}Nouveau mot de passe - StageCraft{% endblock %}

{% block main %}
<div class="container py-5">
    <div class="row justify-content-center align-items-center height-60">
        <div class="col-md-6 col-lg-5">
            
            <div class="p-5 bg-white rounded-3 shadow-sm border border-secondary-subtle">
                {% if validlink %}
                    <div class="text-center mb-4">
                        <div class="mb-3">
                            <i class="bi bi-key display-4 text-warning"></i>
                        </div>
                        <h2 class="h3 fw-bold mb-2">Réinitialisation</h2>
                        <p class="text-muted small">Veuillez choisir votre nouveau mot de passe.</p>
                    </div>

                    <form method="post" id="form_password_reset" class="d-grid gap-3">
                        {% csrf_token %}
                        
                        {# Gestion des erreurs du formulaire Django #}
                        {% if form.errors %}
                            <div class="alert alert-danger small">
                                Veuillez corriger les erreurs ci-dessous.
                            </div>
                        {% endif %}

                        {# Affichage manuel des champs pour contrôler le style #}
                        {% for field in form %}
                        <div>
                            <label class="form-label fw-semibold small text-secondary">{{ field.label }}</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-end-0"><i class="bi bi-lock text-muted"></i></span>
                                {# On ajoute manuellement les classes Bootstrap au champ #}
                                <input type="{{ field.field.widget.input_type }}" 
                                       name="{{ field.name }}" 
                                       class="form-control bg-light border-start-0 ps-0" 
                                       required 
                                       id="{{ field.id_for_label }}">
                            </div>
                            {% if field.help_text %}
                                <div class="form-text small text-muted mt-1">{{ field.help_text|safe }}</div>
                            {% endif %}
                            {% for error in field.errors %}
                                <div class="text-danger small mt-1">{{ error }}</div>
                            {% endfor %}
                        </div>
                        {% endfor %}

                        <button class="btn btn-warning btn-lg rounded-pill shadow-sm mt-3 fw-bold" type="submit">
                            <i class="bi bi-check-lg me-2"></i>Changer le mot de passe
                        </button>
                    </form>

                {% else %}
                    <div class="text-center">
                        <div class="mb-3">
                            <i class="bi bi-exclamation-circle display-4 text-danger"></i>
                        </div>
                        <h2 class="h3 fw-bold text-danger mb-3">Lien invalide</h2>
                        <p class="text-muted mb-4">
                            Ce lien de réinitialisation est invalide ou a expiré. Veuillez refaire une demande.
                        </p>
                        <a href="/password_reset" class="btn btn-warning rounded-pill px-4">
                            Refaire une demande
                        </a>
                    </div>
                {% endif %}
            </div>

        </div>
    </div>
</div>
{% endblock %}